'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _graphql=require('graphql');var randomName=function randomName(len){var text='';var possible='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';for(var i=0;i<len;i++){text+=possible.charAt(Math.floor(Math.random()*possible.length));}return text;};var mapToObject=function mapToObject(mainObj,prop,instance){switch(instance){case'ObjectID':mainObj[prop]={type:_graphql.GraphQLString};break;case'String':mainObj[prop]={type:_graphql.GraphQLString};break;case'Date':mainObj[prop]={type:_graphql.GraphQLString};break;case'Mixed':mainObj[prop]={type:_graphql.GraphQLString};break;case'Boolean':mainObj[prop]={type:_graphql.GraphQLBoolean};break;case'Buffer':mainObj[prop]={type:_graphql.GraphQLBoolean};break;case'Number':mainObj[prop]={type:_graphql.GraphQLInt};break;case'Array':mainObj[prop]={type:new _graphql.GraphQLList(_graphql.GraphQLString)};break;}return mainObj;};function createType(args){if(args.schema&&args.schema.paths){var GQLS={name:args.name,description:args.description,fields:{}};var tmpArgsObj=_extends({},args.schema.paths);var newSchemaObject={};var noChildSchema={};var circularFields=[];var circularListFields=[];for(var key in tmpArgsObj){if(tmpArgsObj[key].hasOwnProperty('schema')){newSchemaObject[key]=tmpArgsObj[key];tmpArgsObj[key]={};}}for(var _key in tmpArgsObj){if(tmpArgsObj.hasOwnProperty(_key)&&!tmpArgsObj[_key].schema){noChildSchema[_key]=tmpArgsObj[_key];}}Object.keys(noChildSchema).forEach(function(k){if(!noChildSchema[k].hasOwnProperty('schema')){var path=k.split('.');var last=path.pop();if(path.length){path.reduce(function(r,a){return r[a]=r[a]||{};},noChildSchema)[last]=noChildSchema[k];path.reduce(function(r,a){return r[a]=r[a]||{};},noChildSchema)[last].path=last;delete noChildSchema[k];}}});for(var _key2 in noChildSchema){if(noChildSchema.hasOwnProperty(_key2)&&!newSchemaObject.hasOwnProperty(_key2)){newSchemaObject[_key2]=noChildSchema[_key2];}}for(var _key3 in newSchemaObject){if(newSchemaObject.hasOwnProperty(_key3)){if(!newSchemaObject[_key3].caster&&!newSchemaObject[_key3].hasOwnProperty('instance')){var subArgs={name:_key3+'SubType_'+randomName(10),description:'sub-object type for '+_key3,class:args.class,schema:{paths:newSchemaObject[_key3]},exclude:args.exclude};GQLS.fields[_key3]={type:createType(subArgs)};}else if(!newSchemaObject[_key3].caster&&newSchemaObject[_key3].schema){var _subArgs={name:newSchemaObject[_key3].path+'SubType_'+randomName(10),description:'sub-object type for '+args.name,class:args.class,schema:newSchemaObject[_key3].schema,exclude:args.exclude};var typeElement=createType(_subArgs);GQLS.fields[_key3]={type:new _graphql.GraphQLList(typeElement)};}else if(!newSchemaObject[_key3].caster&&newSchemaObject[_key3]&&newSchemaObject[_key3].path&&newSchemaObject[_key3].instance&&newSchemaObject[_key3].path!=='__v'&&!newSchemaObject[_key3].schema){GQLS.fields=mapToObject(GQLS.fields,newSchemaObject[_key3].path,newSchemaObject[_key3].instance,newSchemaObject);}else if(newSchemaObject[_key3].caster){if(newSchemaObject[_key3].casterConstructor){circularListFields.push(_key3);}else{circularFields.push(_key3);}GQLS.fields[_key3]={};}}}if(args.exclude){args.exclude.forEach(function(prop){if(GQLS.fields[prop]){delete GQLS.fields[prop];}});}if(args.extend){Object.keys(args.extend).forEach(function(prop){GQLS.fields[prop]=args.extend[prop];});}// to support old version
if(args.props){Object.keys(args.props).forEach(function(prop){GQLS.fields[prop]=args.props[prop];});}if(args.class==='GraphQLObjectType'){var typeSchema=new _graphql.GraphQLObjectType(_extends({},GQLS,{fields:function fields(){circularFields.forEach(function(key){return GQLS.fields[key]=typeSchema;});circularListFields.forEach(function(key){return GQLS.fields[key]=new _graphql.GraphQLList(typeSchema);});return GQLS.fields;}}));return typeSchema;}else if(args.class==='GraphQLInputObjectType'){var _typeSchema=new _graphql.GraphQLInputObjectType(_extends({},GQLS,{fields:function fields(){circularFields.forEach(function(key){return GQLS.fields[key]=_typeSchema;});circularListFields.forEach(function(key){return GQLS.fields[key]=new _graphql.GraphQLList(_typeSchema);});return GQLS.fields;}}));return _typeSchema;}else if(args.class==='GraphQLInterfaceType'){var _typeSchema2=new _graphql.GraphQLInterfaceType(_extends({},GQLS,{fields:function fields(){circularFields.forEach(function(key){return GQLS.fields[key]=_typeSchema2;});circularListFields.forEach(function(key){return GQLS.fields[key]=new _graphql.GraphQLList(_typeSchema2);});return GQLS.fields;}}));return _typeSchema2;}else if(args.class==='GraphQLUnionType'){var _typeSchema3=new _graphql.GraphQLUnionType(_extends({},GQLS,{fields:function fields(){circularFields.forEach(function(key){return GQLS.fields[key]=_typeSchema3;});circularListFields.forEach(function(key){return GQLS.fields[key]=new _graphql.GraphQLList(_typeSchema3);});return GQLS.fields;}}));return _typeSchema3;}else if(args.class==='GraphQLEnumType'){var _typeSchema4=new _graphql.GraphQLEnumType(_extends({},GQLS,{fields:function fields(){circularFields.forEach(function(key){return GQLS.fields[key]=_typeSchema4;});circularListFields.forEach(function(key){return GQLS.fields[key]=new _graphql.GraphQLList(_typeSchema4);});return GQLS.fields;}}));return _typeSchema4;}return new SyntaxError('Enter correct graphQL class name.');}}exports.default=createType;